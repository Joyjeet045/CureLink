{% extends "base.html" %}
{% block content %}

<div class="card mx-4 mx-md-5 shadow-5-strong" style="
        
        background: hsla(0, 0%, 100%, 0.8);
        backdrop-filter: blur(30px);
        ">
		<div class="card-body py-5 px-md-5">

			<div class="row d-flex justify-content-center">
				<div class="col-lg-8">
					<h2 class="fw-bold mb-5">Sign Up!</h2>
          <form method="POST" action="{% url 'register' %}" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="row">
              <div class="col-md-6 mb-4">
                <div class="form-outline">
                  <input type="text" id="first_name" class="form-control" name="first_name"
                    placeholder="First name*" required />
                  <label class="form-label" for="first_name">First name</label>
                </div>
              </div>
              <div class="col-md-6 mb-4">
                <div class="form-outline">
                  <input type="text" id="last_name" class="form-control" name="last_name"
                    placeholder="Last name" />
                  <label class="form-label" for="last_name">Last name</label>
                </div>
              </div>
            </div>
            <div class="form-outline mb-4">
							<input type="text" id="username" class=" form-control" name="username"
								placeholder="Username" required />
							<label class="form-label" for="username">Username</label>
						</div>

						<div class="form-outline mb-4">
							<input type="email" id="email" class=" form-control" name="email" placeholder="Email"
								required />
							<label class="form-label" for="email">Email</label>
						</div>
            <div class="form-outline mb-4">
							<input type="password" id="password1" class="form-control" name="password1"
								placeholder="Password" required />
							<label class="form-label" for="password1">Password</label>
						</div>

						<div class="form-outline mb-4">
							<input type="password" id="password2" class="form-control" name="password2"
								placeholder="Re-enter your password" required />
							<label class="form-label" for="password2"> Confirm Password</label>
						</div>
						<br>

            <div class="mb-4">
              <label class="form-label">Register as:</label><br>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="role" id="role_user" value="user" checked>
                <label class="form-check-label" for="role_user">User</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="role" id="role_doctor" value="doctor">
                <label class="form-check-label" for="role_doctor">Doctor</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="role" id="role_seller" value="seller">
                <label class="form-check-label" for="role_seller">Seller</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="role" id="role_admin" value="admin">
                <label class="form-check-label" for="role_admin">Admin</label>
              </div>
            </div>
            <div id="doctor-fields" style="display:none;">
              <div class="form-outline mb-4">
                <input type="text" id="mobile" class="form-control" name="mobile" placeholder="Mobile" />
                <label class="form-label" for="mobile">Mobile</label>
              </div>
              <div class="mb-4">
                <label for="department" class="form-label">Department</label>
                <select id="department" class="form-select" name="department">
                  {% for dept in depts %}
                  <option value="{{ dept }}">{{dept}}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="mb-4">
                <label for="profile_pic" class="form-label">Profile Picture</label>
                <input type="file" id="profile_pic" class="form-control" name="profile_pic">
              </div>
              <div class="mb-4">
                <label for="hospitals" class="form-label">Hospitals</label>
                <select multiple id="hospitals" class="form-select" name="hospitals">
                  {% for hospital in hospital_ch %}
                  <option value="{{ hospital.id }}">{{ hospital.name }} - {{hospital.state}}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="form-outline mb-4">
                <input type="text" id="qualifications" class="form-control" name="qualifications" placeholder="Qualifications" />
                <label class="form-label" for="qualifications">Qualifications</label>
              </div>
            </div>
            <div id="admin-fields" style="display:none;">
              <div class="form-outline mb-4">
                <input type="text" id="admin_key" class="form-control" name="admin_key" placeholder="Admin Access Key" />
                <label class="form-label" for="admin_key">Admin Access Key</label>
              </div>
            </div>
            <script>
              document.addEventListener('DOMContentLoaded', function() {
                var doctorFields = document.getElementById('doctor-fields');
                var adminFields = document.getElementById('admin-fields');
                var roleRadios = document.getElementsByName('role');
                function updateRoleFields() {
                  var selectedRole = Array.from(roleRadios).find(r => r.checked).value;
                  if (selectedRole === 'doctor') {
                    doctorFields.style.display = '';
                  } else {
                    doctorFields.style.display = 'none';
                  }
                  if (selectedRole === 'admin') {
                    adminFields.style.display = '';
                    document.getElementById('admin_key').setAttribute('required', 'required');
                  } else {
                    adminFields.style.display = 'none';
                    document.getElementById('admin_key').removeAttribute('required');
                  }
                }
                roleRadios.forEach(function(radio) {
                  radio.addEventListener('change', updateRoleFields);
                });
                updateRoleFields();
              });
            </script>
            <input type="submit" class="btn btn-primary btn-block" value="Register with a Click">
          </form>
          <div class="text-center">
            <p>
							Already have an account? <a href="{% url 'login' %}" class="ml-2">Login</a>
						</p>
          </div>
          <div class="text-center">
            {% if messages %}
            {% for message in messages %}
            <div class="alert {% if 'success' in message.tags %}alert-success{% elif 'info' in message.tags %}alert-warning{% endif %}" role="alert">
              {{message}}
            </div>
            {% endfor %}
            {% endif %}
          </div>
        </div>
      </div>
    </div>
</div>
{% endblock %}